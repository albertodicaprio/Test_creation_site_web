<!DOCTYPE html>
<html>
  <head>
    <title>Voyage à Florence</title>
  </head>
  <body>
    <h1>Bienvenue à notre site web pour le voyage d'étude à Florence</h1>
    <p>Ce site est destiné à tracer le profit créé pour notre voyage d'étude.</p>

    <h2>Live prix échange USD/CHF</h2>
    <div id="usdchf">chargement prix échange USD/CHF...</div>

    <h2>Live prix action NVDA</h2>
    <div id="nvda">chargement prix NVDA...</div>

    <h2>Live prix action GOOGL</h2>
    <div id="googl">chargement prix GOOGL...</div>

    <h2>Live profit (NVDA + GOOGL, 40%)</h2>
    <div id="profit">Chargement profit combiné...</div>

       <script>
  const sharesA       = 20;
  const priceA_USD    = 124.60;
  const rateA_CHF     = 0.9025;
  const commissionA   = 30;

  const sharesB       = 50;
  const priceB_USD    = 98.80;
  const rateB_CHF     = 0.8560;
  const commissionB   = 40;

  const shares = 70;
  const ratePercentage = 0.4;

  const buyCostCHF = 
    (sharesA * priceA_USD * rateA_CHF) + commissionA +
    (sharesB * priceB_USD * rateB_CHF) + commissionB;
    
  const avgCostCHF = buyCostCHF / shares;
  console.log("avgCostCHF:", avgCostCHF.toFixed(2));

  let usdchfRate = null;
  let nvdaPrice = null;

  fetch('./.netlify/functions/getprices')
    .then(res => res.json())
    .then(data => {
      console.log("Fetched data:", data); 
      usdchfRate = parseFloat(data.usdchf);
      nvdaPrice = parseFloat(data.currentPrice);
      googlPrice = parseFloat(data.googlPrice)

      document.getElementById('usdchf').innerText = `USD/CHF: ${usdchfRate}`;
      document.getElementById('nvda').innerText = `NVDA: $${nvdaPrice}`;
      document.getElementById('googl').innerText = `GOOGL: $${googlPrice}`;

   function calculateProfit() {
  if (usdchfRate === null || nvdaPrice === null || googlPrice === null) return;

  const sharesA       = 20;
  const priceA_USD    = 124.60;
  const rateA_CHF     = 0.9025;
  const commissionA   = 30;

  const sharesB       = 50;
  const priceB_USD    = 98.80;
  const rateB_CHF     = 0.8560;
  const commissionB   = 40;

  const totalSharesNVDA = 70;
  const costNVDA = 
      (sharesA * priceA_USD * rateA_CHF) + commissionA +
      (sharesB * priceB_USD * rateB_CHF) + commissionB;
  const avgCostCHF_NVDA = costNVDA / totalSharesNVDA;
  const nvdaCHF = nvdaPrice * usdchfRate;
  const profitPerShareNVDA = nvdaCHF - avgCostCHF_NVDA;
  const totalProfitCHF_NVDA = profitPerShareNVDA * totalSharesNVDA;

  const sharesGOOGL         = 70;
  const googlBuyPriceUSD    = 189.35;
  const googlBuyRateCHF     = 0.7962042;
  const googlCommissionCHF  = 67.12;

  const totalCostCHF_GOOGL = (sharesGOOGL * googlBuyPriceUSD * googlBuyRateCHF) + googlCommissionCHF;
  const avgCostCHF_GOOGL = totalCostCHF_GOOGL / sharesGOOGL;
  const googlCHF = googlPrice * usdchfRate;
  const profitPerShareGOOGL = googlCHF - avgCostCHF_GOOGL;
  const totalProfitCHF_GOOGL = profitPerShareGOOGL * sharesGOOGL;

  const totalProfit = totalProfitCHF_NVDA + totalProfitCHF_GOOGL;
  const sharedProfit = totalProfit * 0.4;

  document.getElementById('profit').innerText = `Estimated Shared Profit (40%): CHF ${sharedProfit.toFixed(2)}`;

  console.log("--- Debug ---");
  console.log("NVDA CHF price:", nvdaCHF.toFixed(2));
  console.log("GOOGL CHF price:", googlCHF.toFixed(2));
  console.log("NVDA profit:", totalProfitCHF_NVDA.toFixed(2));
  console.log("GOOGL profit:", totalProfitCHF_GOOGL.toFixed(2));
  console.log("Total raw profit:", totalProfit.toFixed(2));
  console.log("Shared 40%:", sharedProfit.toFixed(2));
}
    </script>
  </body>
</html>
