<!DOCTYPE html>
<html>
  <head>
    <title>Voyage à Florence</title>
  </head>
  <body>
    <h1>Bienvenue à notre site web pour le voyage d'étude à Florence</h1>
    <p>Ce site est destiné à tracer le profit créé pour notre voyage d'étude.</p>

    <h2>Live prix échange USD/CHF</h2>
    <div id="usdchf">chargement prix échange USD/CHF...</div>

    <h2>Live prix action NVDA</h2>
    <div id="nvda">chargement prix NVDA...</div>
    
    <h2>Live profit avec l'investissement NVDA</h2>
    <div id="profit">Calculating profit...</div>

    <script>
  const sharesA       = 20;
  const priceA_USD    = 124.60;
  const rateA_CHF     = 0.9025;
  const commissionA   = 30;

  const sharesB       = 50;
  const priceB_USD    = 98.80;
  const rateB_CHF     = 0.8560;
  const commissionB   = 40;

  const shares = 70;
  const ratePercentage = 0.4;

  const buyCostCHF = 
      (sharesA * priceA_USD * rateA_CHF) + commissionA +
      (sharesB * priceB_USD * rateB_CHF) + commissionB;
  const avgCostCHF = buyCostCHF / shares;

  let usdchfRate = null;
  let nvdaPrice = null;
  console.log("avgCostCHF:", avgCostCHF.toFixed(2));
  fetch('./.netlify/functions/getprices')
    .then(res => res.json())
    .then(data => {
      console.log("Fetched data:", data); 
      usdchfRate = parseFloat(data.usdchf);
      nvdaPrice = parseFloat(data.currentPrice);

      document.getElementById('usdchf').innerText = `USD/CHF: ${usdchfRate}`;
      document.getElementById('nvda').innerText = `NVDA: $${nvdaPrice}`;

      calculateProfit();
    })
    .catch(err => {
      console.error('Fetch error:', err);
      document.getElementById('usdchf').innerText = 'Failed to load USD/CHF';
      document.getElementById('nvda').innerText = 'Failed to load NVDA price';
    });

function calculateProfit() {
  if (usdchfRate === null || nvdaPrice === null) return;
  
  const nvdaPriceCHF = nvdaPrice * usdchfRate;
  const profitPerShare = nvdaPriceCHF - avgCostCHF;
  const totalProfitCHF = profitPerShare * shares * ratePercentage;
  document.getElementById('profit').innerText = `Estimated Profit: CHF ${totalProfitCHF.toFixed(2)}`;
  document.getElementById('debug').innerText = 
    `NVDA CHF: ${nvdaPriceCHF.toFixed(2)} | avgCostCHF: ${avgCostCHF.toFixed(2)} | Shares: ${shares} | Profit Rate: ${ratePercentage * 100}%`;
  
    console.log("NVDA USD price:", nvdaPrice);
    console.log("USD/CHF rate:", usdchfRate);
    console.log("NVDA CHF price:", (nvdaPrice * usdchfRate).toFixed(2));
    console.log("avgCostCHF:", avgCostCHF.toFixed(2));
    console.log("shares:", shares);
    console.log("ratePercentage:", ratePercentage);

    document.getElementById('profit').innerText = `Estimated Profit: CHF ${profit.toFixed(2)}`;
  }
    </script>
  </body>
</html>
